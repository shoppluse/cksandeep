<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kitchen Admin</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body{
background: linear-gradient(135deg,#ff7a18,#ffb347,#ff416c);
min-height:100vh;
font-family:sans-serif;
color:white;
}

.glass{
background: rgba(255,255,255,0.15);
backdrop-filter: blur(16px);
border-radius:22px;
box-shadow:0 20px 40px rgba(0,0,0,0.2);
}

.card{
transition:all .25s ease;
}
.card:hover{
transform:translateY(-6px) scale(1.02);
box-shadow:0 20px 40px rgba(0,0,0,.25);
}

.badge{
padding:4px 10px;
border-radius:999px;
font-size:12px;
font-weight:bold;
}

.rice{background:#22c55e}
.curry{background:#ef4444}
.snacks{background:#eab308}
.dessert{background:#a855f7}
.default{background:#3b82f6}
</style>

</head>

<body class="p-6">

<h1 class="text-4xl font-bold mb-6 text-center">üçõ Kitchen Admin Panel</h1>

<!-- STATS -->

<div class="grid md:grid-cols-2 gap-4 mb-8">
<div class="glass p-5 text-center">
<h2 class="text-xl">Total Dishes</h2>
<p id="total" class="text-3xl font-bold">0</p>
</div>
<div class="glass p-5 text-center">
<h2 class="text-xl">Potential Revenue</h2>
<p id="revenue" class="text-3xl font-bold">‚Çπ0</p>
</div>
</div>

<!-- ADD FORM -->

<div class="glass p-6 max-w-xl mx-auto mb-10">
<h2 class="text-2xl mb-4">Add / Edit Dish</h2>

<input id="name" placeholder="Dish name" class="w-full p-3 rounded-lg text-black mb-3">
<input id="category" placeholder="Category (Rice/Curry/Dessert)" class="w-full p-3 rounded-lg text-black mb-3">
<input id="price" type="number" placeholder="Price ‚Çπ" class="w-full p-3 rounded-lg text-black mb-3">

<button onclick="saveDish()" id="saveBtn"
class="w-full bg-green-500 hover:bg-green-600 p-3 rounded-xl font-bold">
Save Dish </button>

<input type="hidden" id="dishId">
</div>

<!-- SEARCH -->

<input id="search" oninput="loadMenu()" placeholder="üîç Search dishes..."
class="w-full max-w-xl mx-auto block mb-6 p-3 rounded-lg text-black">

<!-- MENU -->

<div id="menu-list" class="grid md:grid-cols-3 gap-6"></div>

<script>

const API="https://cloud-kitchen-w9zx.onrender.com/api/dishes";

let saving=false;

function categoryClass(cat){
cat=cat.toLowerCase();
if(cat.includes("rice")) return "rice";
if(cat.includes("curry")) return "curry";
if(cat.includes("dessert")) return "dessert";
if(cat.includes("snack")) return "snacks";
return "default";
}

async function loadMenu(){
const res=await fetch(API);
const dishes=await res.json();

const search=document.getElementById("search").value.toLowerCase();

const container=document.getElementById("menu-list");
container.innerHTML="";

let total=0;

dishes
.filter(d=>d.name.toLowerCase().includes(search))
.forEach(dish=>{

total+=dish.price;

const card=document.createElement("div");
card.className="glass card p-5";

card.innerHTML=`
<h2 class="text-xl font-bold mb-2">${dish.name}</h2>
<span class="badge ${categoryClass(dish.category)}">${dish.category}</span>
<p class="text-2xl font-bold mt-3">‚Çπ${dish.price}</p>

<div class="mt-4 flex gap-2">
<button onclick='editDish(${JSON.stringify(dish)})'
class="bg-yellow-400 px-3 py-2 rounded">Edit</button>

<button onclick="deleteDish('${dish._id}')"
class="bg-red-500 px-3 py-2 rounded">Delete</button>
</div>
`;

container.appendChild(card);
});

document.getElementById("total").innerText=dishes.length;
document.getElementById("revenue").innerText="‚Çπ"+total;
}

async function saveDish(){
if(saving) return;
saving=true;

const btn=document.getElementById("saveBtn");
btn.innerText="Saving...";
btn.disabled=true;

const id=document.getElementById("dishId").value;
const name=document.getElementById("name").value.trim();
const category=document.getElementById("category").value.trim();
const price=document.getElementById("price").value.trim();

if(!name||!category||!price){
alert("Fill all fields");
saving=false;
btn.innerText="Save Dish";
btn.disabled=false;
return;
}

const data={name,category,price};

if(id){
await fetch(API+"/"+id,{
method:"PUT",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(data)
});
}else{
await fetch(API,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(data)
});
}

document.getElementById("dishId").value="";
document.getElementById("name").value="";
document.getElementById("category").value="";
document.getElementById("price").value="";

loadMenu();

saving=false;
btn.innerText="Save Dish";
btn.disabled=false;
}

function editDish(d){
document.getElementById("dishId").value=d._id;
document.getElementById("name").value=d.name;
document.getElementById("category").value=d.category;
document.getElementById("price").value=d.price;
window.scrollTo({top:0,behavior:"smooth"});
}

async function deleteDish(id){
if(confirm("Delete this dish?")){
await fetch(API+"/"+id,{method:"DELETE"});
loadMenu();
}
}

setInterval(()=>fetch(API).catch(()=>{}),240000);

loadMenu();

</script>

</body>
</html>
