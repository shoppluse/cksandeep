<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analytics Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gradient-to-br from-indigo-100 to-indigo-200 min-h-screen p-6">

<a href="index.html" class="text-indigo-700 font-semibold">‚Üê Back</a>

<h1 class="text-3xl font-bold mt-4 mb-6">üß† Menu Intelligence Dashboard</h1>

<!-- TOP DISH -->
<div class="bg-white rounded-2xl shadow-xl p-6 max-w-6xl mb-6 text-center">
<h2 class="text-xl font-bold">Top Performing Dish</h2>
<p id="topDish" class="text-3xl font-bold text-green-600">No data</p>
</div>

<!-- TABLE -->
<div class="bg-white rounded-2xl shadow-xl p-6 max-w-6xl">
<table class="w-full text-left">
<thead class="bg-indigo-100">
<tr>
<th class="p-3">Rank</th>
<th class="p-3">Dish</th>
<th class="p-3">Cost</th>
<th class="p-3">Price</th>
<th class="p-3">Profit</th>
<th class="p-3">Margin</th>
<th class="p-3">Suggestion</th>
<th class="p-3">Action</th>
</tr>
</thead>
<tbody id="analyticsTable"></tbody>
</table>
</div>

<!-- CHART -->
<div class="bg-white rounded-2xl shadow-xl p-6 max-w-6xl mt-6">
<h2 class="text-xl font-bold mb-4">Profit Margin Chart</h2>
<canvas id="chart"></canvas>
</div>

<script>
let data = JSON.parse(localStorage.getItem("analysis") || "[]");

/* SORT BY MARGIN */
data.sort((a,b)=>b.margin-a.margin);

/* TOP DISH */
if(data.length){
document.getElementById("topDish").innerText =
data[0].dish + " ("+data[0].margin.toFixed(1)+"%)";
}

/* RENDER TABLE */
function render(){
analyticsTable.innerHTML="";
let labels=[], margins=[];

data.forEach((d,i)=>{

let suggestion="";
if(d.margin < 30){
let newPrice = d.cost / 0.6;
suggestion="Increase to ‚Çπ"+newPrice.toFixed(0);
}
else if(d.margin > 60){
suggestion="You can reduce price";
}
else{
suggestion="Perfect";
}

labels.push(d.dish);
margins.push(d.margin);

analyticsTable.innerHTML+=`
<tr class="border-b">
<td class="p-3 font-bold">#${i+1}</td>
<td class="p-3">${d.dish}</td>
<td class="p-3">‚Çπ${d.cost.toFixed(2)}</td>
<td class="p-3">‚Çπ${d.price.toFixed(2)}</td>
<td class="p-3">‚Çπ${d.profit.toFixed(2)}</td>
<td class="p-3">${d.margin.toFixed(1)}%</td>
<td class="p-3 text-blue-600">${suggestion}</td>
<td class="p-3">
<button onclick="remove(${i})" class="text-red-600">Delete</button>
</td>
</tr>`;
});

/* CHART */
new Chart(document.getElementById("chart"),{
type:"bar",
data:{
labels:labels,
datasets:[{
label:"Profit Margin %",
data:margins
}]
},
options:{responsive:true}
});
}

function remove(index){
if(confirm("Delete this analysis?")){
data.splice(index,1);
localStorage.setItem("analysis",JSON.stringify(data));
location.reload();
}
}

render();
</script>

</body>
</html>
